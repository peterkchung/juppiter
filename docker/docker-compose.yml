# About: Compose config for juppiter dev container.
# Handles display forwarding and source mounts for live editing.
#
# Usage:
#   docker compose -f docker/docker-compose.yml build
#   docker compose -f docker/docker-compose.yml up -d
#   docker compose -f docker/docker-compose.yml exec dev bash

services:
  dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile.dev
    container_name: juppiter-dev

    # Live-mount source so edits on host are reflected without rebuild.
    # Run `colcon build` inside the container after changes.
    # WSLg mounts allow GUI apps (RViz2) to render on host display.
    volumes:
      - ../src:/ws/src
      - ../config:/ws/config
      - ../launch:/ws/launch
      - ../data:/ws/data
      - ../scripts:/ws/scripts
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /mnt/wslg:/mnt/wslg

    # WSLg display forwarding for RViz2 and rqt.
    environment:
      - DISPLAY=${DISPLAY}
      - WAYLAND_DISPLAY=${WAYLAND_DISPLAY}
      - XDG_RUNTIME_DIR=/tmp

    network_mode: host
    stdin_open: true
    tty: true
